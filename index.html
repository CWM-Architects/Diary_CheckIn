<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <link rel="icon" href="/Ting_check_manager/0rigin.svg" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title data-i18n="APP_TITLE">出勤管家</title>

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="出勤管家">
    <meta property="og:description" content="智能出勤打卡管理系統 - 支援排班管理、薪資計算、加班請假申請">
    <meta property="og:image" content="https://cwm-architects.github.io/Diary_CheckIn/0rigin.svg">
    <meta property="og:url" content="https://cwm-architects.github.io/Diary_CheckIn/">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="出勤管家">
    <meta property="og:locale" content="zh_TW">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="出勤管家">
    <meta name="twitter:description" content="智能出勤打卡管理系統 - 支援排班管理、薪資計算、加班請假申請">
    <meta name="twitter:image" content="https://cwm-architects.github.io/Diary_CheckIn/0rigin.svg">

    <!-- 一般 Meta -->
    <meta name="description" content="智能出勤打卡管理系統 - 支援排班管理、薪資計算、加班請假申請">
    <meta name="keywords" content="出勤,打卡,排班,薪資,加班,請假,考勤管理">
    <meta name="author" content="Xun">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {}
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            const toggleButton = document.getElementById('theme-toggle');
            const htmlElement = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');

            function updateThemeIcon() {
                if (htmlElement.classList.contains('dark')) {
                    themeIcon.textContent = '☀️';
                } else {
                    themeIcon.textContent = '🌙';
                }
            }

            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                htmlElement.classList.add('dark');
            } else {
                htmlElement.classList.remove('dark');
            }

            updateThemeIcon();

            toggleButton.addEventListener('click', () => {
                htmlElement.classList.toggle('dark');

                if (htmlElement.classList.contains('dark')) {
                    localStorage.setItem('theme', 'dark');
                } else {
                    localStorage.setItem('theme', 'light');
                }

                updateThemeIcon();
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>

    <style>
        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="time"]::-webkit-calendar-picker-indicator {
            filter: var(--date-picker-filter, none);
        }

        .dark input[type="date"]::-webkit-calendar-picker-indicator,
        .dark input[type="time"]::-webkit-calendar-picker-indicator {
            --date-picker-filter: invert(1);
        }

        select option {
            background-color: white;
            color: black;
        }

        .dark select option {
            background-color: #374151;
            color: white;
        }
    </style>
</head>

<body
    class="flex items-center justify-center min-h-screen p-4 bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100">
    <div id="app-container" class="w-full max-w-md mx-auto">
        <!-- User Profile & Header -->
        <header id="user-header" class="flex items-center justify-between p-4 mb-6 card fade-in" style="display: none;">

            <div class="flex items-center space-x-3">
                <img id="profile-img" src="https://placehold.co/40x40/e0e0e0/757575?text=U" alt="頭像"
                    class="w-10 h-10 rounded-full">
                <div>
                    <p id="user-name" class="font-semibold">使用者名稱</p>
                    <p id="welcome-mes" data-i18n="WELCOME_BACK" class="text-xs text-gray-500">歡迎回來！</p>
                </div>
            </div>

            <div class="flex flex-col items-end space-y-2">

                <div class="flex items-center space-x-3">
                    <button id="logout-btn" data-i18n="BTN_LOGOUT"
                        class="text-sm font-medium text-gray-600 hover:text-indigo-600 dark:text-gray-400 dark:hover:text-indigo-400">登出</button>
                    <button id="theme-toggle"
                        class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200">
                        <span id="theme-icon">[暗]</span>
                    </button>
                </div>
                <select id="language-switcher"
                    class="text-sm font-medium text-gray-600 rounded-md p-1 dark:text-gray-300 dark:bg-gray-700 max-w-xs">
                    <option value="zh-TW">繁體中文</option>
                    <option value="en-US">English</option>
                    <option value="id">Bahasa Indonesia</option>
                    <option value="vi">Tiếng Việt</option>
                    <option value="ja">日本語</option>
                    <option value="ko">한국어</option>
                    <option value="th">ภาษาไทย</option>
                </select>

            </div>

        </header>

        <!-- Login Section -->
        <section id="login-section" class="text-center p-8 card fade-in">
            <img src="/Ting_check_manager/0rigin.svg" alt="打卡系統橫幅圖" class="main-image">
            <h1 id="appTitle" data-i18n="SUBTITLE_LOGIN" class="text-2xl font-bold text-gray-800 mb-2 dark:text-white">
                歡迎出勤管家</h1>
            <p class="text-gray-600 mb-6" data-i18n="LOGIN_INFO" id="status">請點擊登入以繼續。</p>
            <div id="login" class="space-y-4">
                <button id="login-btn" data-i18n="BTN_LOGOIN" class="w-full py-3 px-4 rounded-lg font-bold btn-primary"
                    style="display: none;">使用LINE登入</button>
            </div>
        </section>

        <!-- Main App Content -->
        <div id="main-app" class="fade-in" style="display: none;">
            <!-- Tab Navigation -->
            <div class="flex justify-center space-x-2 mb-6 flex-wrap gap-y-2">
                <button id="tab-dashboard-btn" data-i18n="TAB_DASHBOARD"
                    class="py-2 px-4 rounded-full font-bold text-sm text-white bg-indigo-600 dark:bg-indigo-500">儀表板</button>
                <button id="tab-monthly-btn" data-i18n="TAB_MONTHLY"
                    class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200 dark:text-gray-300 dark:bg-gray-700">出勤記錄</button>
                <button id="tab-location-btn" data-i18n="TAB_LOCATION"
                    class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200 dark:text-gray-300 dark:bg-gray-700">定位</button>
                <!-- 👇 排班按鈕 (新增) -->
                <button id="tab-shift-btn" data-i18n="TAB_SHIFT"
                    class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200 dark:text-gray-300 dark:bg-gray-700">排班</button>
                <button id="tab-salary-btn" data-i18n="TAB_SALARY"
                    class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200 dark:text-gray-300 dark:bg-gray-700">薪資</button>
                <!-- 👇 加班按鈕 -->
                <button id="tab-overtime-btn" data-i18n="TAB_OVERTIME"
                    class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200 dark:text-gray-300 dark:bg-gray-700">加班</button>
                <!-- 👇 請假按鈕 -->
                <button id="tab-leave-btn" data-i18n="TAB_LEAVE"
                    class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200 dark:text-gray-300 dark:bg-gray-700">請假</button>
                <button id="tab-admin-btn" data-i18n="TAB_ADMIN"
                    class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200 dark:text-gray-300 dark:bg-gray-700"
                    style="display: none;">管理員</button>
                <button id="tab-expense-btn" data-i18n="TAB_EXPENSE"
                    class="py-2 px-4 rounded-full font-bold text-sm text-gray-600 bg-gray-200 dark:text-gray-300 dark:bg-gray-700">
                    費用
                </button>
            </div>

            <!-- Dashboard View -->
            <main id="dashboard-view" class="space-y-6">
                <!-- 📢 佈告欄區塊 -->
                <div
                    class="card p-6 bg-gradient-to-r from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 border-2 border-indigo-200 dark:border-indigo-700">
                    <h2 data-i18n="ANNOUNCEMENT_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-4">
                        📢 最新公告
                    </h2>
                    <div id="announcements-empty" data-i18n="ANNOUNCEMENT_EMPTY"
                        class="text-center text-gray-500 dark:text-gray-400 py-4">
                        目前沒有公告
                    </div>
                    <div id="announcements-list"></div>
                </div>
                <!-- 打卡專區 -->
                <div class="card p-6">
                    <h2 data-i18n="PUNCH_SECTION_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-1">
                        打卡專區
                    </h2>
                    <p data-i18n="PUNCH_SECTION_DESC" class="text-gray-500 dark:text-gray-400 mb-4">
                        請點擊下方按鈕進行上班或下班打卡。
                    </p>
                    <div class="flex space-x-4">
                        <button id="punch-in-btn" data-i18n="BTN_PUNCH_IN"
                            class="flex-1 py-3 rounded-lg font-bold btn-primary">
                            上班打卡
                        </button>
                        <button id="punch-out-btn" data-i18n="BTN_PUNCH_OUT"
                            class="flex-1 py-3 rounded-lg font-bold btn-secondary">
                            下班打卡
                        </button>
                    </div>
                    <!-- 生物辨識快速打卡區 -->
                    <div id="biometric-punch-section" class="border-t border-gray-200 dark:border-gray-700 pt-4 mt-4">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <h3 data-i18n="BIOMETRIC_PUNCH_TITLE"
                                    class="text-sm font-semibold text-gray-800 dark:text-white">
                                    生物辨識快速打卡
                                </h3>
                                <p data-i18n="BIOMETRIC_PUNCH_DESC" class="text-xs text-gray-500 dark:text-gray-400">
                                    使用 Face ID 或指紋一鍵打卡
                                </p>
                            </div>
                            <div id="biometric-status" class="text-xs">
                                <span id="biometric-not-setup" data-i18n="BIOMETRIC_STATUS_NOT_SETUP"
                                    class="text-gray-400">未設定</span>
                                <span id="biometric-ready" data-i18n="BIOMETRIC_STATUS_ENABLED"
                                    class="text-green-600 hidden">已啟用</span>
                            </div>
                        </div>

                        <!-- 設定生物辨識按鈕 -->
                        <button id="setup-biometric-btn" data-i18n="BIOMETRIC_SETUP_BTN"
                            class="w-full py-2 px-4 rounded-lg font-semibold text-sm bg-gradient-to-r from-purple-500 to-indigo-600 text-white hover:from-purple-600 hover:to-indigo-700 transition-all mb-2">
                            設定生物辨識打卡
                        </button>

                        <!-- 快速打卡按鈕（設定後顯示） -->
                        <div id="biometric-punch-buttons" class="grid grid-cols-2 gap-3 hidden">
                            <button id="biometric-punch-in-btn"
                                class="py-2 px-4 rounded-lg font-semibold text-sm bg-green-600 hover:bg-green-700 text-white transition-all flex items-center justify-center space-x-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                </svg>
                                <span data-i18n="BIOMETRIC_PUNCH_IN_BTN">上班打卡</span>
                            </button>
                            <button id="biometric-punch-out-btn"
                                class="py-2 px-4 rounded-lg font-semibold text-sm bg-red-600 hover:bg-red-700 text-white transition-all flex items-center justify-center space-x-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                </svg>
                                <span data-i18n="BIOMETRIC_PUNCH_OUT_BTN">下班打卡</span>
                            </button>
                        </div>
                    </div>
                    <!-- LINE 頻道快速加入按鈕 -->
                    <a href="https://line.me/R/ti/p/@766blobh" target="_blank"
                        class="block mt-4 p-4 bg-gradient-to-r from-green-400 to-green-500 hover:from-green-500 hover:to-green-600 rounded-lg transition-all duration-300 shadow-lg hover:shadow-xl">
                        <div class="flex items-center justify-center space-x-3">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314" />
                            </svg>
                            <div class="text-left">
                                <p data-i18n="LINE_CHANNEL_TITLE" class="text-white font-bold text-sm">
                                    加入員工 LINE 頻道，掌握最新公告！
                                </p>
                                <p data-i18n="LINE_CHANNEL_ID" class="text-green-100 text-xs mt-0.5">
                                    @766blobh
                                </p>
                            </div>
                        </div>
                    </a>
                </div>

                <!-- ✅ 修正：考勤紀錄區塊 -->
                <div id="abnormal-records-section" class="card p-6" style="display: none;">
                    <h2 data-i18n="ABNORMAL_RECORDS_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        考勤紀錄
                    </h2>
                    <p data-i18n="ABNORMAL_RECORDS_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">
                        系統會自動偵測本月異常紀錄，您可以在此進行補打卡。
                    </p>

                    <!-- ✅ 新增容器包裹 -->
                    <div id="abnormal-records-container">
                        <div id="abnormal-records-loading" data-i18n="RECORDS_LOADING"
                            class="text-center text-gray-500 dark:text-gray-400">
                            正在載入記錄...
                        </div>
                        <div id="abnormal-records-empty"
                            class="text-center text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30 p-4 rounded-lg"
                            style="display: none;">
                            <p data-i18n="ABNORMAL_RECORDS_EMPTY" class="font-semibold">
                                太棒了！本月目前沒有任何異常紀錄。
                            </p>
                        </div>
                        <ul id="abnormal-list" class="space-y-3"></ul>
                    </div>

                    <!-- ✅ 補打卡表單容器 -->
                    <div id="adjustment-form-container" class="mt-4"></div>
                </div>
            </main>

            <!-- Monthly View -->
            <section id="monthly-view" class="space-y-6" style="display: none;">

                <!-- ✨ 本月統計區塊 -->
                <div
                    class="bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-900 rounded-xl shadow-lg p-6 mb-6 border border-gray-200 dark:border-gray-700">
                    <div class="flex items-center mb-4 pb-3 border-b border-gray-200 dark:border-gray-700">
                        <div class="w-1 h-6 bg-indigo-600 dark:bg-indigo-400 rounded-full mr-3"></div>
                        <h3 data-i18n="MONTHLY_STATS_TITLE" class="text-lg font-bold text-gray-800 dark:text-white">
                            本月出勤統計
                        </h3>
                    </div>

                    <!-- 統計數據列表（四行垂直排列） -->
                    <div class="space-y-3">

                        <!-- 出勤天數 -->
                        <div
                            class="flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/30 dark:to-green-800/20 rounded-lg border border-green-200 dark:border-green-700/50 transition-all hover:shadow-md">
                            <span data-i18n="STATS_WORK_DAYS"
                                class="text-sm font-medium text-gray-700 dark:text-gray-300">出勤天數</span>
                            <div class="flex items-baseline">
                                <span id="stats-work-days-value"
                                    class="text-2xl font-bold text-green-600 dark:text-green-400">0</span>
                                <span data-i18n="UNIT_DAYS"
                                    class="text-sm font-medium text-green-500 dark:text-green-400 ml-1">天</span>
                            </div>
                        </div>

                        <!-- 異常記錄 -->
                        <div
                            class="flex items-center justify-between p-4 bg-gradient-to-r from-red-50 to-red-100 dark:from-red-900/30 dark:to-red-800/20 rounded-lg border border-red-200 dark:border-red-700/50 transition-all hover:shadow-md">
                            <span data-i18n="STATS_ABNORMAL_COUNT"
                                class="text-sm font-medium text-gray-700 dark:text-gray-300">異常記錄</span>
                            <div class="flex items-baseline">
                                <span id="stats-abnormal-count-value"
                                    class="text-2xl font-bold text-red-600 dark:text-red-400">0</span>
                                <span data-i18n="UNIT_RECORDS"
                                    class="text-sm font-medium text-red-500 dark:text-red-400 ml-1">筆</span>
                            </div>
                        </div>

                        <!-- 正常打卡 -->
                        <div
                            class="flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/30 dark:to-blue-800/20 rounded-lg border border-blue-200 dark:border-blue-700/50 transition-all hover:shadow-md">
                            <span data-i18n="STATS_NORMAL_DAYS"
                                class="text-sm font-medium text-gray-700 dark:text-gray-300">正常打卡</span>
                            <div class="flex items-baseline">
                                <span id="stats-normal-days-value"
                                    class="text-2xl font-bold text-blue-600 dark:text-blue-400">0</span>
                                <span data-i18n="UNIT_DAYS"
                                    class="text-sm font-medium text-blue-500 dark:text-blue-400 ml-1">天</span>
                            </div>
                        </div>

                        <!-- 加班時數 -->
                        <div
                            class="flex items-center justify-between p-4 bg-gradient-to-r from-orange-50 to-orange-100 dark:from-orange-900/30 dark:to-orange-800/20 rounded-lg border border-orange-200 dark:border-orange-700/50 transition-all hover:shadow-md">
                            <span data-i18n="STATS_OVERTIME_HOURS"
                                class="text-sm font-medium text-gray-700 dark:text-gray-300">加班時數</span>
                            <div class="flex items-baseline">
                                <span id="stats-overtime-hours-value"
                                    class="text-2xl font-bold text-orange-600 dark:text-orange-400">0</span>
                                <span data-i18n="UNIT_HOURS"
                                    class="text-sm font-medium text-orange-500 dark:text-orange-400 ml-1">小時</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 日曆卡片 -->
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-4">
                        <button id="prev-month"
                            class="text-gray-600 dark:text-gray-400 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">&lt;</button>
                        <h3 id="month-title" class="font-bold text-xl text-gray-800 dark:text-white"></h3>
                        <button id="next-month"
                            class="text-gray-600 dark:text-gray-400 p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">&gt;</button>
                    </div>

                    <div class="mb-4">
                        <button id="export-attendance-btn" data-i18n="EXPORT_ATTENDANCE_BTN"
                            class="w-full py-2 px-4 rounded-lg font-bold btn-secondary hover:opacity-90 transition-opacity">
                            匯出本月出勤報表
                        </button>
                    </div>

                    <div
                        class="grid grid-cols-7 text-center text-sm font-semibold text-gray-500 dark:text-gray-400 mb-2">
                        <span data-i18n="WEEK_SUNDAY">日</span>
                        <span data-i18n="WEEK_MONDAY">一</span>
                        <span data-i18n="WEEK_TUESDAY">二</span>
                        <span data-i18n="WEEK_WEDNESDAY">三</span>
                        <span data-i18n="WEEK_THURSDAY">四</span>
                        <span data-i18n="WEEK_FRIDAY">五</span>
                        <span data-i18n="WEEK_SATURDAY">六</span>
                    </div>
                    <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>
                </div>

                <!-- ✅ 新增：每日記錄卡片 -->
                <div id="daily-records-card" class="card p-6" style="display: none;">
                    <h3 id="daily-records-title" class="text-lg font-bold text-gray-800 dark:text-white mb-4">
                    </h3>

                    <!-- 載入狀態 -->
                    <div id="daily-records-loading" data-i18n="RECORDS_LOADING"
                        class="text-center text-gray-500 dark:text-gray-400 py-4" style="display: none;">
                        正在載入記錄...
                    </div>

                    <!-- 無記錄提示 -->
                    <div id="daily-records-empty"
                        class="text-center text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg"
                        style="display: none;">
                        <p data-i18n="DAILY_RECORDS_EMPTY" class="font-semibold">
                            當日無打卡記錄
                        </p>
                    </div>

                    <!-- 記錄列表 -->
                    <ul id="daily-records-list" class="space-y-3 mb-4"></ul>

                    <!-- ✅ 補打卡表單容器 -->
                    <div id="daily-adjustment-form-container"></div>
                </div>
            </section>

            <!-- Location View -->
            <section id="location-view" class="space-y-6" style="display: none;">
                <div class="card p-6">
                    <h2 data-i18n="CURRENT_LOCATION_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-1">
                        當前位置</h2>
                    <p data-i18n="CURRENT_LOCATION_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">系統將透過 GPS
                        偵測您的位置。</p>

                    <div id="map-container"
                        class="w-full h-64 rounded-lg mb-4 bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-gray-500 dark:text-gray-400">
                        <div id="map-loading-text">
                            <span data-i18n="MAP_LOADING">正在載入地圖...</span>
                        </div>
                    </div>
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <p class="text-sm text-gray-600 dark:text-gray-300">
                            <strong data-i18n="LOCATION_STATUS_LABEL">狀態：</strong>
                            <span id="location-status" data-i18n="LOCATION_STATUS_PENDING">未偵測</span>
                        </p>
                        <p class="text-sm text-gray-600 dark:text-gray-300">
                            <strong data-i18n="COORDINATES_LABEL">經緯度：</strong>
                            <span id="location-coords" data-i18n="COORDINATES_UNKNOWN">未知</span>
                        </p>
                    </div>
                </div>
            </section>

            <!-- 👇 排班頁面 (Shift View) - 新增 -->
            <section id="shift-view" class="space-y-6" style="display: none;">
                <div class="card p-6">
                    <h2 data-i18n="SHIFT_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-4">排班管理</h2>
                    <p data-i18n="SHIFT_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">查看和管理員工排班資訊</p>

                    <div class="space-y-4">
                        <button onclick="window.location.href='shift.html'" data-i18n="BTN_SHIFT_MANAGEMENT"
                            class="w-full py-3 px-4 rounded-lg font-bold btn-primary">
                            進入排班管理
                        </button>

                        <div
                            class="bg-indigo-50 dark:bg-indigo-900/30 border border-indigo-200 dark:border-indigo-700 rounded-lg p-4">
                            <h3 data-i18n="SHIFT_TODAY_TITLE"
                                class="font-semibold text-indigo-800 dark:text-indigo-300 mb-3">今日排班</h3>
                            <div id="today-shift-loading" data-i18n="SHIFT_LOADING"
                                class="text-sm text-indigo-600 dark:text-indigo-400">載入中...</div>
                            <div id="today-shift-empty" class="text-sm text-indigo-600 dark:text-indigo-400"
                                style="display: none;">
                                <p data-i18n="SHIFT_TODAY_EMPTY">今日無排班</p>
                            </div>
                            <div id="today-shift-info" class="space-y-2" style="display: none;">
                                <div class="flex justify-between text-sm">
                                    <span data-i18n="SHIFT_TYPE_LABEL"
                                        class="text-indigo-700 dark:text-indigo-400">班別:</span>
                                    <span id="shift-type"
                                        class="font-semibold text-indigo-900 dark:text-indigo-200">--</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span data-i18n="SHIFT_TIME_LABEL"
                                        class="text-indigo-700 dark:text-indigo-400">時間:</span>
                                    <span id="shift-time"
                                        class="font-semibold text-indigo-900 dark:text-indigo-200">--</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span data-i18n="SHIFT_LOCATION_LABEL"
                                        class="text-indigo-700 dark:text-indigo-400">地點:</span>
                                    <span id="shift-location"
                                        class="font-semibold text-indigo-900 dark:text-indigo-200">--</span>
                                </div>
                            </div>
                        </div>

                        <!-- 👇 加上 style="display: none;" -->
                        <div class="bg-purple-50 dark:bg-purple-900/30 border border-purple-200 dark:border-purple-700 rounded-lg p-4"
                            style="display: none;">
                            <h3 data-i18n="SHIFT_WEEK_TITLE"
                                class="font-semibold text-purple-800 dark:text-purple-300 mb-3">
                                未來排班
                            </h3>

                            <div id="week-shift-loading" data-i18n="SHIFT_LOADING"
                                class="text-sm text-purple-600 dark:text-purple-400">
                                載入中...
                            </div>

                            <div id="week-shift-empty" class="text-sm text-purple-600 dark:text-purple-400"
                                style="display: none;">
                                <p data-i18n="SHIFT_WEEK_EMPTY">未來 7 天無排班</p>
                            </div>

                            <div id="week-shift-list" class="space-y-2"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 👇 加班頁面 (Overtime View) -->
            <section id="overtime-view" class="space-y-6" style="display: none;">

                <!-- 加班申請表單 -->
                <div class="card p-6">
                    <h2 data-i18n="OVERTIME_APPLY_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        加班申請
                    </h2>
                    <p data-i18n="OVERTIME_APPLY_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">
                        填寫以下資訊以提交加班申請
                    </p>

                    <div class="space-y-4">
                        <!-- 加班日期 -->
                        <div>
                            <label data-i18n="OVERTIME_DATE_LABEL" for="overtime-date"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                加班日期
                            </label>
                            <input type="date" id="overtime-date"
                                class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                        </div>

                        <!-- 開始時間與結束時間 -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label data-i18n="OVERTIME_START_TIME_LABEL" for="overtime-start-time"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    開始時間
                                </label>
                                <input type="time" id="overtime-start-time"
                                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label data-i18n="OVERTIME_END_TIME_LABEL" for="overtime-end-time"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    結束時間
                                </label>
                                <input type="time" id="overtime-end-time"
                                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                        </div>

                        <!-- 加班時數 -->
                        <div>
                            <label data-i18n="OVERTIME_HOURS_LABEL" for="overtime-hours"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                加班時數
                            </label>
                            <input type="number" id="overtime-hours" step="0.5" min="0.5" placeholder="0.0"
                                class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                        </div>

                        <!-- 加班原因 -->
                        <div>
                            <label data-i18n="OVERTIME_REASON_LABEL" for="overtime-reason"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                加班原因
                            </label>
                            <textarea id="overtime-reason" rows="3"
                                class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500"
                                placeholder="請說明加班原因..."></textarea>
                        </div>

                        <!-- 提交按鈕 -->
                        <button id="submit-overtime-btn" data-i18n="BTN_SUBMIT_OVERTIME"
                            class="w-full py-3 px-4 rounded-lg font-bold btn-primary">
                            提交加班申請
                        </button>
                    </div>
                </div>

                <!-- 加班記錄列表 -->
                <div class="card p-6">
                    <h2 data-i18n="OVERTIME_RECORDS_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        我的加班記錄
                    </h2>
                    <p data-i18n="OVERTIME_RECORDS_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">
                        查看已提交的加班申請狀態
                    </p>

                    <div id="overtime-records-container">
                        <div id="overtime-records-loading" data-i18n="RECORDS_LOADING"
                            class="text-center text-gray-500 dark:text-gray-400 py-4">
                            正在載入記錄...
                        </div>
                        <div id="overtime-records-empty"
                            class="text-center text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg"
                            style="display: none;">
                            <p data-i18n="OVERTIME_NO_RECORDS" class="font-semibold">
                                目前沒有加班記錄
                            </p>
                        </div>
                        <ul id="overtime-records-list" class="space-y-3"></ul>
                    </div>
                </div>

            </section>

            <!-- 👇 請假頁面 (Leave View) -->
            <section id="leave-view" class="space-y-6" style="display: none;">

                <!-- 👇 新增：假期餘額顯示區塊 -->
                <div class="card p-6">
                    <h2 data-i18n="LEAVE_BALANCE_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        假期餘額
                    </h2>
                    <p data-i18n="LEAVE_BALANCE_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">
                        查看您目前可用的各類假期天數
                    </p>

                    <div id="leave-balance-container">
                        <div id="leave-balance-loading" data-i18n="RECORDS_LOADING"
                            class="text-center text-gray-500 dark:text-gray-400 py-4">
                            正在載入餘額...
                        </div>
                        <div id="leave-balance-list" class="space-y-2"></div>
                    </div>
                </div>
                <!-- 請假申請表單 -->
                <div class="card p-6">
                    <h2 data-i18n="LEAVE_APPLY_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        請假申請
                    </h2>
                    <p data-i18n="LEAVE_APPLY_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">
                        填寫以下資訊以提交請假申請
                    </p>

                    <div class="space-y-4">
                        <!-- 請假類型 -->
                        <div>
                            <label data-i18n="LEAVE_TYPE_LABEL" for="leave-type"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                請假類型
                            </label>
                            <select id="leave-type"
                                class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                                <option value="">請選擇請假類型</option>
                                <option value="ANNUAL_LEAVE" data-i18n-option="ANNUAL_LEAVE">特休假</option>
                                <option value="COMP_TIME_OFF" data-i18n-option="COMP_TIME_OFF">加班補休假</option>
                                <option value="PERSONAL_LEAVE" data-i18n-option="PERSONAL_LEAVE">事假</option>
                                <option value="SICK_LEAVE" data-i18n-option="SICK_LEAVE">未住院病假</option>
                                <option value="HOSPITALIZATION_LEAVE" data-i18n-option="HOSPITALIZATION_LEAVE">住院病假
                                </option>
                                <option value="BEREAVEMENT_LEAVE" data-i18n-option="BEREAVEMENT_LEAVE">喪假</option>
                                <option value="MARRIAGE_LEAVE" data-i18n-option="MARRIAGE_LEAVE">婚假</option>
                                <option value="PATERNITY_LEAVE" data-i18n-option="PATERNITY_LEAVE">陪產檢及陪產假</option>
                                <option value="MATERNITY_LEAVE" data-i18n-option="MATERNITY_LEAVE">產假</option>
                                <option value="OFFICIAL_LEAVE" data-i18n-option="OFFICIAL_LEAVE">公假（含兵役假）</option>
                                <option value="WORK_INJURY_LEAVE" data-i18n-option="WORK_INJURY_LEAVE">公傷假</option>
                                <option value="NATURAL_DISASTER_LEAVE" data-i18n-option="NATURAL_DISASTER_LEAVE">天然災害停班
                                </option>
                                <option value="FAMILY_CARE_LEAVE" data-i18n-option="FAMILY_CARE_LEAVE">家庭照顧假</option>
                                <option value="MENSTRUAL_LEAVE" data-i18n-option="MENSTRUAL_LEAVE">生理假</option>
                            </select>
                        </div>

                        <!-- 快速選擇時段 -->
                        <div
                            class="bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                            <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-3">
                                <span data-i18n="QUICK_SELECT">快速選擇</span>
                            </h3>
                            <div class="grid grid-cols-2 gap-2">
                                <button type="button" onclick="quickSelectTimeRange('1h')"
                                    class="px-3 py-2 text-sm bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-lg hover:bg-indigo-50 dark:hover:bg-gray-500 transition-colors">
                                    1 小時
                                </button>
                                <button type="button" onclick="quickSelectTimeRange('2h')"
                                    class="px-3 py-2 text-sm bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-lg hover:bg-indigo-50 dark:hover:bg-gray-500 transition-colors">
                                    2 小時
                                </button>
                                <button type="button" onclick="quickSelectTimeRange('4h')"
                                    class="px-3 py-2 text-sm bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-lg hover:bg-indigo-50 dark:hover:bg-gray-500 transition-colors">
                                    半天 (4小時)
                                </button>
                                <button type="button" onclick="quickSelectTimeRange('8h')"
                                    class="px-3 py-2 text-sm bg-white dark:bg-gray-600 border border-gray-300 dark:border-gray-500 rounded-lg hover:bg-indigo-50 dark:hover:bg-gray-500 transition-colors">
                                    全天 (8小時)
                                </button>
                            </div>
                        </div>

                        <!-- 請假時段 -->
                        <div class="space-y-3">
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                <span data-i18n="LEAVE_PERIOD">請假時段</span>
                            </label>

                            <!-- 開始時間 -->
                            <div>
                                <label for="leave-start-datetime"
                                    class="block text-xs text-gray-600 dark:text-gray-400 mb-1">
                                    <span data-i18n="LEAVE_START_TIME">開始時間</span>
                                </label>
                                <input type="datetime-local" id="leave-start-datetime" step="3600"
                                    onchange="updateWorkHoursPreview()"
                                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                            </div>

                            <!-- 結束時間 -->
                            <div>
                                <label for="leave-end-datetime"
                                    class="block text-xs text-gray-600 dark:text-gray-400 mb-1">
                                    <span data-i18n="LEAVE_END_TIME">結束時間</span>
                                </label>
                                <input type="datetime-local" id="leave-end-datetime" step="3600"
                                    onchange="updateWorkHoursPreview()"
                                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                            </div>

                            <!-- ✅ 自動計算顯示（只顯示小時） -->
                            <div id="work-hours-preview"
                                class="hidden bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-700 rounded-lg p-3">
                                <p class="text-sm text-blue-800 dark:text-blue-300">
                                    <span data-i18n="CALCULATED_HOURS">計算時數</span>：
                                    <span id="calculated-hours" class="font-bold text-lg">0</span>
                                    <span data-i18n="UNIT_HOURS">小時</span>
                                </p>
                                <p class="text-xs text-blue-600 dark:text-blue-400 mt-1">
                                    <span data-i18n="LUNCH_BREAK_NOTE">※ 已自動扣除午休時間 (12:00-13:00)</span>
                                </p>
                                <!-- 警告訊息 -->
                                <div id="work-hours-warning"
                                    class="hidden mt-2 text-sm font-medium text-red-600 dark:text-red-400">
                                    <!-- 錯誤訊息會顯示在這裡 -->
                                </div>
                            </div>
                        </div>

                        <!-- 請假原因 -->
                        <div id="leave-reason-container">
                            <label data-i18n="LEAVE_REASON_LABEL" for="leave-reason"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                請假原因
                            </label>
                            <textarea id="leave-reason" rows="3"
                                class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500"
                                placeholder="請說明請假原因..."></textarea>
                        </div>

                        <!-- 提交按鈕 -->
                        <button id="submit-leave-btn" onclick="submitLeaveApplication()" data-i18n="BTN_SUBMIT_LEAVE"
                            class="w-full py-3 px-4 rounded-lg font-bold btn-primary hover:opacity-90 transition-opacity">
                            提交請假申請
                        </button>
                    </div>
                </div>
                <!-- 請假記錄列表 -->
                <div class="card p-6">
                    <h2 data-i18n="LEAVE_RECORDS_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        我的請假記錄
                    </h2>
                    <p data-i18n="LEAVE_RECORDS_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">
                        查看已提交的請假申請狀態
                    </p>

                    <div id="leave-records-container">
                        <div id="leave-records-loading" data-i18n="RECORDS_LOADING"
                            class="text-center text-gray-500 dark:text-gray-400 py-4">
                            正在載入記錄...
                        </div>
                        <div id="leave-records-empty"
                            class="text-center text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg"
                            style="display: none;">
                            <p data-i18n="LEAVE_NO_RECORDS" class="font-semibold">
                                目前沒有請假記錄
                            </p>
                        </div>
                        <ul id="leave-records-list" class="space-y-3"></ul>
                    </div>
                </div>

            </section>

            <!-- 💰 費用管理 -->
            <section id="expense-view" class="space-y-6" style="display: none;">
                <div class="max-w-4xl mx-auto space-y-6">

                    <!-- 🧾 發票辨識助手 -->
                    <div
                        class="card p-6 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900 dark:to-indigo-900">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-2xl">
                                🧾
                            </div>
                            <div>
                                <h2 data-i18n="INVOICE_OCR_TITLE"
                                    class="text-xl font-bold text-gray-800 dark:text-white">
                                    發票辨識助手
                                </h2>
                                <p class="text-sm text-gray-600 dark:text-gray-300">
                                    使用 AI 快速辨識發票資訊
                                </p>
                            </div>
                        </div>

                        <!-- 上傳按鈕 -->
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <button onclick="document.getElementById('invoice-camera-input').click()"
                                data-i18n="BTN_CAMERA_SCAN"
                                class="py-3 px-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg font-bold hover:from-blue-600 hover:to-blue-700 transition-all flex items-center justify-center gap-2">
                                📷 拍照辨識
                            </button>
                            <button onclick="document.getElementById('invoice-file-input').click()"
                                data-i18n="BTN_UPLOAD_SCAN"
                                class="py-3 px-4 bg-gradient-to-r from-indigo-500 to-indigo-600 text-white rounded-lg font-bold hover:from-indigo-600 hover:to-indigo-700 transition-all flex items-center justify-center gap-2">
                                📁 上傳辨識
                            </button>
                        </div>

                        <!-- 隱藏的檔案輸入 -->
                        <input type="file" id="invoice-camera-input" accept="image/*" capture="environment"
                            onchange="handleInvoiceUpload(event, 'camera')" class="hidden">
                        <input type="file" id="invoice-file-input" accept="image/*"
                            onchange="handleInvoiceUpload(event, 'file')" class="hidden">

                        <!-- 圖片預覽容器 -->
                        <div id="invoice-preview-container" class="hidden mb-4">
                            <img id="invoice-preview" src="" alt="發票預覽"
                                class="w-full max-h-64 object-contain rounded-lg border-2 border-gray-300 dark:border-gray-600">
                        </div>

                        <!-- 載入中 -->
                        <div id="ocr-loading" class="hidden text-center py-6">
                            <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500">
                            </div>
                            <p data-i18n="OCR_PROCESSING" class="mt-4 text-gray-600 dark:text-gray-300">
                                AI 正在辨識發票內容...
                            </p>
                        </div>

                        <!-- 辨識成功 -->
                        <div id="ocr-success" class="hidden bg-green-50 dark:bg-green-900 rounded-lg p-4 space-y-3">
                            <p data-i18n="OCR_SUCCESS"
                                class="font-bold text-green-800 dark:text-green-200 mb-3 text-lg">
                                ✅ 辨識成功！
                            </p>

                            <!-- 主要資訊 -->
                            <div class="grid grid-cols-2 gap-3 text-sm bg-white dark:bg-gray-800 p-3 rounded-lg">
                                <div class="col-span-2 border-b pb-2 mb-2">
                                    <span class="text-gray-600 dark:text-gray-300">發票號碼：</span>
                                    <span id="ocr-invoice-number"
                                        class="font-bold text-lg text-gray-800 dark:text-white"></span>
                                </div>

                                <div>
                                    <span class="text-gray-600 dark:text-gray-300">日期：</span>
                                    <span id="ocr-date" class="font-bold text-gray-800 dark:text-white"></span>
                                </div>

                                <div>
                                    <span class="text-gray-600 dark:text-gray-300">時間：</span>
                                    <span id="ocr-time" class="font-bold text-gray-800 dark:text-white"></span>
                                </div>

                                <div>
                                    <span class="text-gray-600 dark:text-gray-300">金額：</span>
                                    <span id="ocr-amount"
                                        class="font-bold text-lg text-green-600 dark:text-green-400"></span>
                                </div>

                                <div>
                                    <span class="text-gray-600 dark:text-gray-300">店家：</span>
                                    <span id="ocr-store" class="font-bold text-gray-800 dark:text-white"></span>
                                </div>
                            </div>

                            <!-- 詳細資訊（可展開） -->
                            <div class="border-t pt-3">
                                <button onclick="toggleOCRDetails()"
                                    class="text-sm text-blue-600 dark:text-blue-400 hover:underline flex items-center space-x-1">
                                    <span id="ocr-details-toggle-icon">▶</span>
                                    <span>查看詳細資訊</span>
                                </button>

                                <div id="ocr-details"
                                    class="hidden mt-3 space-y-2 text-sm bg-gray-50 dark:bg-gray-800 p-3 rounded">
                                    <div class="grid grid-cols-2 gap-2">
                                        <div>
                                            <span class="text-gray-600 dark:text-gray-400">期別：</span>
                                            <span id="ocr-period" class="text-gray-800 dark:text-white"></span>
                                        </div>
                                        <div>
                                            <span class="text-gray-600 dark:text-gray-400">隨機碼：</span>
                                            <span id="ocr-random-code" class="text-gray-800 dark:text-white"></span>
                                        </div>
                                        <div class="col-span-2">
                                            <span class="text-gray-600 dark:text-gray-400">賣方統編：</span>
                                            <span id="ocr-seller-tax-id" class="text-gray-800 dark:text-white"></span>
                                        </div>
                                        <div class="col-span-2">
                                            <span class="text-gray-600 dark:text-gray-400">店家地址：</span>
                                            <span id="ocr-store-address" class="text-gray-800 dark:text-white"></span>
                                        </div>
                                        <div class="col-span-2">
                                            <span class="text-gray-600 dark:text-gray-400">店家電話：</span>
                                            <span id="ocr-store-phone" class="text-gray-800 dark:text-white"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 操作按鈕 -->
                            <div class="grid grid-cols-2 gap-3 mt-4">
                                <button onclick="fillReimbursementForm()" data-i18n="BTN_FILL_FORM"
                                    class="py-2 px-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg font-bold hover:from-green-600 hover:to-green-700 transition-all">
                                    📝 填入表單
                                </button>
                                <button onclick="resetInvoiceOCR()" data-i18n="BTN_SCAN_AGAIN"
                                    class="py-2 px-4 bg-gradient-to-r from-gray-500 to-gray-600 text-white rounded-lg font-bold hover:from-gray-600 hover:to-gray-700 transition-all">
                                    🔄 重新辨識
                                </button>
                            </div>
                        </div>

                        <!-- 辨識失敗 -->
                        <div id="ocr-error" class="hidden bg-red-50 dark:bg-red-900 rounded-lg p-4">
                            <p data-i18n="OCR_ERROR_TITLE" class="font-bold text-red-800 dark:text-red-200 mb-2">
                                ❌ 辨識失敗
                            </p>
                            <p id="ocr-error-message" class="text-red-600 dark:text-red-300 text-sm mb-3">
                                請確認圖片清晰度後重試
                            </p>
                            <button onclick="resetInvoiceOCR()" data-i18n="BTN_SCAN_AGAIN"
                                class="w-full py-2 px-4 bg-red-500 text-white rounded-lg font-bold hover:bg-red-600 transition-all">
                                🔄 重新辨識
                            </button>
                        </div>
                    </div>

                    <!-- 📋 預支申請表單 -->
                    <div class="card p-6">
                        <h2 data-i18n="EXPENSE_ADVANCE_TITLE"
                            class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                            💰 預支申請
                        </h2>
                        <p data-i18n="EXPENSE_ADVANCE_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">
                            填寫以下資訊以提交預支申請
                        </p>

                        <div class="space-y-4">
                            <!-- 申請日期 -->
                            <div>
                                <label data-i18n="EXPENSE_ADVANCE_DATE_LABEL" for="advance-date"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    申請日期
                                </label>
                                <input type="date" id="advance-date"
                                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                            </div>

                            <!-- 申請金額 -->
                            <div>
                                <label data-i18n="EXPENSE_ADVANCE_AMOUNT_LABEL" for="advance-amount"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    申請金額(元)
                                </label>
                                <input type="number" id="advance-amount" min="0" step="1" placeholder="0"
                                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                            </div>

                            <!-- 申請用途 -->
                            <div>
                                <label data-i18n="EXPENSE_ADVANCE_PURPOSE_LABEL" for="advance-purpose"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    申請用途
                                </label>
                                <textarea id="advance-purpose" rows="3" placeholder="請說明申請用途..."
                                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                            </div>

                            <!-- 提交按鈕 -->
                            <button id="submit-advance-btn" onclick="submitAdvanceApplication()"
                                data-i18n="BTN_SUBMIT_ADVANCE"
                                class="w-full py-3 px-4 rounded-lg font-bold btn-primary">
                                提交預支申請
                            </button>
                        </div>
                    </div>

                    <!-- 📄 報銷申請表單 -->
                    <div class="card p-6">
                        <h2 data-i18n="EXPENSE_REIMBURSEMENT_TITLE"
                            class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                            📄 報銷申請
                        </h2>
                        <p data-i18n="EXPENSE_REIMBURSEMENT_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">
                            上傳發票並填寫會計憑證資訊
                        </p>

                        <div class="space-y-4">
                            <!-- 上傳發票照片（僅供參考，不會上傳到後台） -->
                            <div>
                                <label data-i18n="EXPENSE_INVOICE_UPLOAD_LABEL" for="reimb-invoice-upload"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    上傳發票照片（選填 - 僅供本地預覽）
                                </label>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mb-2">
                                    💡 提示：發票圖片僅用於前端預覽和 OCR 辨識，不會上傳到伺服器
                                </p>
                                <div class="flex items-center space-x-3">
                                    <input type="file" id="reimbursement-invoice-image" accept="image/*"
                                        capture="environment" class="hidden">
                                    <button type="button"
                                        onclick="document.getElementById('reimbursement-invoice-image').click()"
                                        class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold flex items-center space-x-2">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                                        </svg>
                                        <span data-i18n="BTN_TAKE_PHOTO">拍照預覽</span>
                                    </button>
                                    <span id="reimb-invoice-file-name" class="text-sm text-gray-500 dark:text-gray-400">
                                        尚未選擇檔案
                                    </span>
                                </div>
                                <!-- 預覽圖片 -->
                                <div id="reimb-invoice-preview" class="mt-3 hidden">
                                    <img id="reimb-invoice-preview-img" src="" alt="發票預覽"
                                        class="max-w-full h-auto rounded-lg border border-gray-300 dark:border-gray-600">
                                </div>
                            </div>

                            <!-- 費用日期 -->
                            <div>
                                <label data-i18n="EXPENSE_DATE_LABEL" for="reimbursement-date"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    費用日期 <span class="text-red-500">*</span>
                                </label>
                                <input type="date" id="reimbursement-date"
                                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                            </div>

                            <!-- 費用摘要 -->
                            <div>
                                <label data-i18n="EXPENSE_SUMMARY_LABEL" for="reimbursement-summary"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    費用摘要 <span class="text-red-500">*</span>
                                </label>
                                <input type="text" id="reimbursement-summary" placeholder="例如：購買辦公用品、客戶餐費"
                                    maxlength="100"
                                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                            </div>

                            <!-- 報銷金額 -->
                            <div>
                                <label data-i18n="EXPENSE_AMOUNT_LABEL" for="reimbursement-amount"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    報銷金額（元）<span class="text-red-500">*</span>
                                </label>
                                <input type="number" id="reimbursement-amount" min="0" step="1" placeholder="0"
                                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                            </div>

                            <!-- 發票號碼 -->
                            <div>
                                <label data-i18n="EXPENSE_INVOICE_NUMBER_LABEL" for="reimbursement-invoice-number"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    發票號碼
                                </label>
                                <input type="text" id="reimbursement-invoice-number" placeholder="例如：AA-12345678"
                                    maxlength="20"
                                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                            </div>

                            <!-- ⭐⭐⭐ 新增：發票詳細資訊（對應 Google Sheets 欄位）-->
                            <details
                                class="bg-gray-50 dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600">
                                <summary
                                    class="cursor-pointer font-medium text-gray-700 dark:text-gray-300 mb-3 hover:text-indigo-600 dark:hover:text-indigo-400">
                                    📋 發票詳細資訊（OCR 自動填入）
                                </summary>

                                <div class="space-y-3">
                                    <!-- 發票時間 (G 欄) -->
                                    <div>
                                        <label for="reimbursement-invoice-time"
                                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            發票時間
                                        </label>
                                        <input type="time" id="reimbursement-invoice-time"
                                            class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>

                                    <!-- 店家地址（如果需要） -->
                                    <div>
                                        <label for="reimbursement-store-address"
                                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            店家地址
                                        </label>
                                        <input type="text" id="reimbursement-store-address" placeholder="OCR 自動辨識"
                                            class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>

                                    <!-- 店家電話（如果需要） -->
                                    <div>
                                        <label for="reimbursement-store-phone"
                                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            店家電話
                                        </label>
                                        <input type="tel" id="reimbursement-store-phone" placeholder="OCR 自動辨識"
                                            class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>

                                    <!-- 賣方統編 (J 欄) -->
                                    <div>
                                        <label for="reimbursement-seller-tax-id"
                                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            賣方統編
                                        </label>
                                        <input type="text" id="reimbursement-seller-tax-id" maxlength="8"
                                            placeholder="8 位數字"
                                            class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>

                                    <!-- 隨機碼 (K 欄) -->
                                    <div>
                                        <label for="reimbursement-random-code"
                                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            隨機碼
                                        </label>
                                        <input type="text" id="reimbursement-random-code" maxlength="4"
                                            placeholder="4 位數字"
                                            class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>

                                    <!-- 期別 (L 欄) -->
                                    <div>
                                        <label for="reimbursement-period"
                                            class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                            期別
                                        </label>
                                        <input type="text" id="reimbursement-period" placeholder="例如：11312"
                                            class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                </div>
                            </details>
                            <!-- 備註 -->
                            <div>
                                <label data-i18n="EXPENSE_NOTE_LABEL" for="reimbursement-note"
                                    class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                    備註
                                </label>
                                <textarea id="reimbursement-note" rows="2" placeholder="其他補充說明..."
                                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                            </div>

                            <!-- 提交按鈕 -->
                            <button id="submit-reimbursement-btn" onclick="submitReimbursementApplication()"
                                data-i18n="BTN_SUBMIT_REIMBURSEMENT"
                                class="w-full py-3 px-4 rounded-lg font-bold btn-primary">
                                生成憑證並送出
                            </button>
                        </div>
                    </div>

                    <!-- 我的申請記錄 -->
                    <div class="card p-6">
                        <h2 data-i18n="EXPENSE_RECORDS_TITLE"
                            class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                            我的申請記錄
                        </h2>
                        <p data-i18n="EXPENSE_RECORDS_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">
                            查看已提交的費用申請狀態
                        </p>

                        <!-- Tab 切換 -->
                        <div class="flex space-x-2 mb-4">
                            <button id="tab-advance-records"
                                class="px-4 py-2 rounded-lg font-semibold text-sm bg-indigo-600 text-white">
                                預支申請
                            </button>
                            <button id="tab-reimbursement-records"
                                class="px-4 py-2 rounded-lg font-semibold text-sm bg-gray-200 text-gray-600 dark:bg-gray-700 dark:text-gray-300">
                                報銷申請
                            </button>
                        </div>

                        <div id="expense-records-container">
                            <!-- 預支記錄 -->
                            <div id="advance-records-list">
                                <div id="advance-records-loading" data-i18n="RECORDS_LOADING"
                                    class="text-center text-gray-500 dark:text-gray-400 py-4">
                                    正在載入記錄...
                                </div>
                                <div id="advance-records-empty"
                                    class="text-center text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg"
                                    style="display: none;">
                                    <p data-i18n="ADVANCE_NO_RECORDS" class="font-semibold">
                                        目前沒有預支申請記錄
                                    </p>
                                </div>
                                <ul id="advance-records" class="space-y-3"></ul>
                            </div>

                            <!-- 報銷記錄 -->
                            <div id="reimbursement-records-list" style="display: none;">
                                <div id="reimbursement-records-loading" data-i18n="RECORDS_LOADING"
                                    class="text-center text-gray-500 dark:text-gray-400 py-4">
                                    正在載入記錄...
                                </div>
                                <div id="reimbursement-records-empty"
                                    class="text-center text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg"
                                    style="display: none;">
                                    <p data-i18n="REIMBURSEMENT_NO_RECORDS" class="font-semibold">
                                        目前沒有報銷申請記錄
                                    </p>
                                </div>
                                <ul id="reimbursement-records" class="space-y-3"></ul>
                            </div>
                        </div>
                    </div>

                </div> <!-- 結束 max-w-4xl mx-auto space-y-6 -->

            </section>

            <!-- 👇 薪資頁面 (Salary View) - 修改為跳轉按鈕 -->
            <section id="salary-view" class="space-y-6" style="display: none;">

                <!-- 薪資管理標題卡片 -->
                <div class="card p-8">
                    <h2 class="text-3xl font-bold text-gray-800 dark:text-white mb-2"
                        data-i18n="SALARY_MANAGEMENT_TITLE">
                        薪資管理
                    </h2>
                    <p class="text-gray-500 dark:text-gray-400" data-i18n="SALARY_MANAGEMENT_DESC">
                        查看和管理員工薪資資訊
                    </p>
                </div>

                <!-- 進入薪資管理系統按鈕 -->
                <div class="card p-6">
                    <button onclick="window.location.href='salary.html'" data-i18n="BTN_SALARY_SYSTEM"
                        class="w-full py-4 px-6 rounded-xl font-bold text-lg btn-primary bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 transition-all duration-300 shadow-lg">
                        進入薪資管理系統
                    </button>
                </div>

                <!-- 功能說明卡片 -->
                <div
                    class="card p-6 bg-gradient-to-br from-indigo-50 to-purple-50 dark:from-indigo-900/20 dark:to-purple-900/20 border-2 border-indigo-200 dark:border-indigo-700">
                    <h3 class="text-xl font-bold text-indigo-900 dark:text-indigo-200 mb-4"
                        data-i18n="SALARY_FEATURES_TITLE">
                        功能說明
                    </h3>
                    <div class="space-y-3">
                        <div class="flex items-start space-x-3">
                            <span class="text-2xl">✓</span>
                            <p class="text-indigo-800 dark:text-indigo-300" data-i18n="SALARY_FEATURE_1">
                                支援全職員工（月薪制）與兼職員工（時薪制）
                            </p>
                        </div>
                        <div class="flex items-start space-x-3">
                            <span class="text-2xl">✓</span>
                            <p class="text-indigo-800 dark:text-indigo-300" data-i18n="SALARY_FEATURE_2">
                                自動計算加班費、扣款項目
                            </p>
                        </div>
                        <div class="flex items-start space-x-3">
                            <span class="text-2xl">✓</span>
                            <p class="text-indigo-800 dark:text-indigo-300" data-i18n="SALARY_FEATURE_3">
                                薪資單生成和管理
                            </p>
                        </div>
                        <div class="flex items-start space-x-3">
                            <span class="text-2xl">✓</span>
                            <p class="text-indigo-800 dark:text-indigo-300" data-i18n="SALARY_FEATURE_4">
                                時薪明細追蹤
                            </p>
                        </div>
                    </div>
                </div>
            </section>
            <!-- Admin View -->
            <section id="admin-view" class="space-y-6" style="display: none;">
                <!-- 📢 公告管理 -->
                <div class="card p-6">
                    <h2 data-i18n="ADMIN_ANNOUNCEMENT_MANAGEMENT"
                        class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        📢 公告管理
                    </h2>

                    <div class="space-y-3 mb-4">
                        <input type="text" id="announcement-title" data-i18n="ANNOUNCEMENT_TITLE_PLACEHOLDER"
                            placeholder="公告標題" maxlength="100"
                            class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white">

                        <textarea id="announcement-content" data-i18n="ANNOUNCEMENT_CONTENT_PLACEHOLDER"
                            placeholder="公告內容" rows="3" maxlength="500"
                            class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white"></textarea>

                        <select id="announcement-priority"
                            class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white">
                            <option value="normal" data-i18n-option="ANNOUNCEMENT_PRIORITY_NORMAL">🔵 一般</option>
                            <option value="medium" data-i18n-option="ANNOUNCEMENT_PRIORITY_MEDIUM">🟡 中等</option>
                            <option value="high" data-i18n-option="ANNOUNCEMENT_PRIORITY_HIGH">🔴 重要</option>
                        </select>

                        <button id="submit-announcement-btn" data-i18n="BTN_PUBLISH_ANNOUNCEMENT"
                            class="w-full py-3 px-4 rounded-lg font-bold btn-primary">
                            發布公告
                        </button>
                    </div>

                    <div id="admin-announcements-list" class="space-y-3"></div>
                </div>
                <div class="card p-6">
                    <h2 data-i18n="PENDING_REQUESTS_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-1">
                        待審核請求</h2>
                    <p data-i18n="PENDING_REQUESTS_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">
                        請處理員工提出的補打卡或虛擬卡請求。</p>
                    <div id="pending-requests-container">
                        <div id="requests-loading" data-i18n="REQUESTS_LOADING"
                            class="text-center text-gray-500 dark:text-gray-400 py-4">正在載入請求...</div>
                        <div id="requests-empty"
                            class="text-center text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30 p-4 rounded-lg"
                            style="display: none;">
                            <p data-i18n="REQUESTS_EMPTY_TITLE" class="font-semibold">太棒了！</p>
                            <p data-i18n="REQUESTS_EMPTY_MESSAGE">目前沒有任何待審核的請求。</p>
                        </div>
                        <ul id="pending-requests-list" class="space-y-3"></ul>
                    </div>
                </div>

                <!-- 👇 新增：管理員匯出所有員工報表 -->
                <div class="card p-6">
                    <h2 data-i18n="ADMIN_EXPORT_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        匯出報表
                    </h2>
                    <p data-i18n="ADMIN_EXPORT_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">
                        匯出所有員工的出勤報表
                    </p>

                    <div class="space-y-4">
                        <!-- 選擇月份 -->
                        <div>
                            <label data-i18n="ADMIN_EXPORT_MONTH_LABEL" for="admin-export-month"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                選擇月份
                            </label>
                            <input type="month" id="admin-export-month"
                                class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                        </div>

                        <!-- 匯出按鈕 -->
                        <button id="admin-export-all-btn" data-i18n="ADMIN_EXPORT_ALL_BTN"
                            class="w-full py-3 px-4 rounded-lg font-bold btn-primary">
                            匯出所有員工報表
                        </button>
                    </div>
                </div>
                <!-- 👇 加班審核區塊 -->
                <div class="card p-6 mt-6">
                    <h2 data-i18n="OVERTIME_PENDING_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        待審核加班申請
                    </h2>
                    <p data-i18n="OVERTIME_PENDING_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">
                        審核員工提出的加班申請
                    </p>

                    <div id="pending-overtime-container">
                        <div id="overtime-requests-loading" data-i18n="REQUESTS_LOADING"
                            class="text-center text-gray-500 dark:text-gray-400 py-4">
                            正在載入請求...
                        </div>
                        <div id="overtime-requests-empty"
                            class="text-center text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30 p-4 rounded-lg"
                            style="display: none;">
                            <p data-i18n="OVERTIME_NO_PENDING" class="font-semibold">
                                太棒了！目前沒有待審核的加班申請。
                            </p>
                        </div>
                        <ul id="pending-overtime-list" class="space-y-3"></ul>
                    </div>
                </div>

                <!-- 👇 請假審核區塊 -->
                <div class="card p-6 mt-6">
                    <h2 data-i18n="LEAVE_PENDING_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        待審核請假申請
                    </h2>
                    <p data-i18n="LEAVE_PENDING_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">
                        審核員工提出的請假申請
                    </p>

                    <div id="pending-leave-container">
                        <div id="leave-requests-loading" data-i18n="REQUESTS_LOADING"
                            class="text-center text-gray-500 dark:text-gray-400 py-4">
                            正在載入請求...
                        </div>
                        <div id="leave-requests-empty"
                            class="text-center text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30 p-4 rounded-lg"
                            style="display: none;">
                            <p data-i18n="LEAVE_NO_PENDING" class="font-semibold">
                                太棒了！目前沒有待審核的請假申請。
                            </p>
                        </div>
                        <ul id="pending-leave-list" class="space-y-3"></ul>
                    </div>
                </div>

                <!-- 💰 待審核預支申請 -->
                <div class="card p-6 mt-6">
                    <h2 data-i18n="ADMIN_ADVANCE_PENDING_TITLE"
                        class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        💰 待審核預支申請
                    </h2>
                    <p data-i18n="ADMIN_ADVANCE_PENDING_DESC" class="text-gray-500 dark:text-gray-400 mb-4">
                        審核員工提出的預支申請
                    </p>

                    <div id="pending-advance-container">
                        <div id="advance-requests-loading" data-i18n="REQUESTS_LOADING"
                            class="text-center text-gray-500 dark:text-gray-400 py-4">
                            正在載入請求...
                        </div>
                        <div id="advance-requests-empty"
                            class="text-center text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30 p-4 rounded-lg"
                            style="display: none;">
                            <p data-i18n="ADVANCE_NO_PENDING" class="font-semibold">
                                太棒了！目前沒有待審核的預支申請。
                            </p>
                        </div>
                        <ul id="pending-advance-list" class="space-y-3"></ul>
                    </div>
                </div>

                <!-- 📄 待審核報銷申請 -->
                <div class="card p-6 mt-6">
                    <h2 data-i18n="ADMIN_REIMBURSEMENT_PENDING_TITLE"
                        class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        📄 待審核報銷申請
                    </h2>
                    <p data-i18n="ADMIN_REIMBURSEMENT_PENDING_DESC" class="text-gray-500 dark:text-gray-400 mb-4">
                        審核員工提出的報銷申請並查看發票
                    </p>

                    <div id="pending-reimbursement-container">
                        <div id="reimbursement-requests-loading" data-i18n="REQUESTS_LOADING"
                            class="text-center text-gray-500 dark:text-gray-400 py-4">
                            正在載入請求...
                        </div>
                        <div id="reimbursement-requests-empty"
                            class="text-center text-green-600 dark:text-green-400 bg-green-50 dark:bg-green-900/30 p-4 rounded-lg"
                            style="display: none;">
                            <p data-i18n="REIMBURSEMENT_NO_PENDING" class="font-semibold">
                                太棒了！目前沒有待審核的報銷申請。
                            </p>
                        </div>
                        <ul id="pending-reimbursement-list" class="space-y-3"></ul>
                    </div>
                </div>
                <div class="card p-6 mt-6">
                    <h2 data-i18n="ADD_LOCATION_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        新增打卡地點
                    </h2>
                    <p data-i18n="ADD_LOCATION_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">
                        輸入地點名稱，並使用您的當前位置作為經緯度。
                    </p>

                    <div class="space-y-4">
                        <!-- 🔍 地點搜尋功能 -->
                        <div>
                            <label data-i18n="SEARCH_LOCATION_LABEL" for="location-search"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                🔍 搜尋地點
                            </label>
                            <div class="relative">
                                <input type="text" id="location-search" data-i18n="SEARCH_LOCATION_PLACEHOLDER"
                                    placeholder="輸入地址或地點名稱搜尋..."
                                    class="w-full p-3 pr-10 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                                <button id="search-location-btn"
                                    class="absolute right-2 top-1/2 transform -translate-y-1/2 text-indigo-600 dark:text-indigo-400 hover:text-indigo-800 dark:hover:text-indigo-300">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                    </svg>
                                </button>
                            </div>
                            <div id="search-results" class="mt-2 max-h-48 overflow-y-auto hidden">
                                <ul id="search-results-list"
                                    class="bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg">
                                </ul>
                            </div>
                        </div>

                        <!-- 地點名稱 -->
                        <div>
                            <label data-i18n="LOCATION_NAME_LABEL" for="location-name"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                地點名稱
                            </label>
                            <input type="text" id="location-name" data-i18n="LOCATION_NAME_PLACEHOLDER"
                                placeholder="例如：台北101"
                                class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm dark:bg-gray-700 dark:text-white focus:ring-indigo-500 focus:border-indigo-500">
                        </div>

                        <!-- 經緯度 -->
                        <div>
                            <label data-i18n="COORDINATES_LAT_LNG_LABEL"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                經緯度 (Latitude / Longitude)
                            </label>
                            <div class="flex space-x-2">
                                <input type="text" id="location-lat" data-i18n="LATITUDE_LABEL" placeholder="緯度"
                                    readonly
                                    class="w-1/2 p-2 rounded-md border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-600 dark:text-white shadow-sm cursor-not-allowed">
                                <input type="text" id="location-lng" data-i18n="LONGITUDE_LABEL" placeholder="經度"
                                    readonly
                                    class="w-1/2 p-2 rounded-md border-gray-300 dark:border-gray-600 bg-gray-100 dark:bg-gray-600 dark:text-white shadow-sm cursor-not-allowed">
                            </div>
                        </div>

                        <!-- 📍 打卡範圍調整 -->
                        <div>
                            <label data-i18n="PUNCH_RANGE_LABEL" for="location-radius"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                打卡範圍
                            </label>
                            <div class="flex items-center space-x-4">
                                <input type="range" id="location-radius" min="100" max="2000" step="50" value="200"
                                    class="flex-1 h-2 bg-indigo-200 rounded-lg appearance-none cursor-pointer dark:bg-indigo-700">
                                <div class="flex items-center space-x-2">
                                    <span id="radius-value"
                                        class="text-lg font-bold text-indigo-600 dark:text-indigo-400">200</span>
                                    <span class="text-sm text-gray-500 dark:text-gray-400">m</span>
                                </div>
                            </div>
                            <p data-i18n="PUNCH_RANGE_DESCRIPTION"
                                class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                拖移滑桿以調整允許打卡的半徑（100-2000 公尺）。
                            </p>
                        </div>

                        <!-- 按鈕組 -->
                        <div class="space-y-2">
                            <button data-i18n="GET_LOCATION_BTN" id="get-location-btn"
                                class="w-full py-3 px-4 rounded-lg font-bold btn-secondary">
                                取得當前位置
                            </button>
                            <button data-i18n="ADD_LOCATION_BTN" id="add-location-btn"
                                class="w-full py-3 px-4 rounded-lg font-bold btn-primary" disabled>
                                新增地點
                            </button>
                        </div>
                    </div>
                </div>
                <!-- 在管理員頁面的適當位置加入 -->
                <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-bold text-gray-800 dark:text-white">
                            👥 用戶管理
                        </h2>
                        <button id="refresh-users-btn"
                            class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg text-sm font-semibold transition-colors">
                            🔄 重新整理
                        </button>
                    </div>

                    <!-- 統計卡片 -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div
                            class="bg-gradient-to-br from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 rounded-lg p-4 border border-blue-200 dark:border-blue-700">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-blue-600 dark:text-blue-400 font-medium">總用戶數</p>
                                    <p id="total-users-count"
                                        class="text-3xl font-bold text-blue-700 dark:text-blue-300">0</p>
                                </div>
                            </div>
                        </div>

                        <div
                            class="bg-gradient-to-br from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 rounded-lg p-4 border border-purple-200 dark:border-purple-700">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-purple-600 dark:text-purple-400 font-medium">管理員</p>
                                    <p id="admin-users-count"
                                        class="text-3xl font-bold text-purple-700 dark:text-purple-300">0</p>
                                </div>
                            </div>
                        </div>

                        <div
                            class="bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 rounded-lg p-4 border border-green-200 dark:border-green-700">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm text-green-600 dark:text-green-400 font-medium">一般員工</p>
                                    <p id="employee-users-count"
                                        class="text-3xl font-bold text-green-700 dark:text-green-300">0</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 搜尋框 -->
                    <div class="mb-4">
                        <input type="text" id="search-users-input" placeholder="🔍 搜尋用戶名稱或部門..."
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm dark:bg-gray-700 dark:text-white focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                    </div>

                    <!-- Loading 狀態 -->
                    <div id="users-loading" class="text-center py-8" style="display: none;">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
                        <p class="mt-2 text-gray-600 dark:text-gray-400">載入中...</p>
                    </div>

                    <!-- 空狀態 -->
                    <div id="users-empty" class="text-center py-8 text-gray-500 dark:text-gray-400"
                        style="display: none;">
                        <p class="text-4xl mb-2">👤</p>
                        <p>沒有找到用戶</p>
                    </div>

                    <!-- 用戶列表 -->
                    <div id="users-list" class="space-y-3"></div>
                </div>
                <!-- 👇 在管理員頁面加入 IP 白名單管理 -->
                <div class="card p-6 mt-6">
                    <h2 data-i18n="IP_WHITELIST_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        IP 白名單管理
                    </h2>
                    <p data-i18n="IP_WHITELIST_DESC" class="text-gray-500 dark:text-gray-400 mb-4">
                        管理允許打卡的 IP 範圍（輔助 GPS 驗證）
                    </p>

                    <!-- 新增 IP -->
                    <div class="space-y-3 mb-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                IP 範圍 <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="ip-range-input" placeholder="例如：203.0.113.0/24 或 192.168.1.100"
                                class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white">
                            <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                支援 CIDR 格式（如 192.168.1.0/24）或單一 IP
                            </p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                描述
                            </label>
                            <input type="text" id="ip-description-input" placeholder="例如：公司總部"
                                class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-800 dark:text-white">
                        </div>

                        <button id="add-ip-btn" onclick="addIPToWhitelist()"
                            class="w-full py-2 px-4 rounded-lg font-bold btn-primary">
                            ➕ 新增 IP
                        </button>
                    </div>

                    <!-- IP 清單 -->
                    <div id="ip-whitelist-container">
                        <div id="ip-whitelist-loading" class="text-center text-gray-500 dark:text-gray-400 py-4">
                            正在載入...
                        </div>
                        <div id="ip-whitelist-empty"
                            class="text-center text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg"
                            style="display: none;">
                            尚未設定 IP 白名單（所有 IP 都可打卡）
                        </div>
                        <ul id="ip-whitelist-list" class="space-y-2"></ul>
                    </div>
                </div>
                <!-- 員工打卡分析區塊 -->
                <div class="card p-6 mt-6">
                    <h2 data-i18n="ADMIN_PUNCH_ANALYSIS_TITLE"
                        class="text-xl font-bold text-gray-800 dark:text-white mb-2">
                        員工打卡分析
                    </h2>
                    <p data-i18n="ADMIN_PUNCH_ANALYSIS_DESC" class="text-gray-500 dark:text-gray-400 mb-4">
                        查看員工每月打卡時間分布與工時統計
                    </p>

                    <div class="space-y-4">
                        <!-- 選擇員工 -->
                        <div>
                            <label data-i18n="SELECT_EMPLOYEE_LABEL" for="analysis-employee"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                選擇員工
                            </label>
                            <select id="analysis-employee"
                                class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white">
                                <option value="" data-i18n-option="SELECT_EMPLOYEE_PLACEHOLDER">請選擇員工</option>
                            </select>
                        </div>

                        <!-- 選擇月份 -->
                        <div>
                            <label data-i18n="SELECT_MONTH_LABEL" for="analysis-month"
                                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                                選擇月份
                            </label>
                            <input type="month" id="analysis-month"
                                class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white">
                        </div>

                        <!-- 查詢按鈕 -->
                        <button id="load-punch-analysis-btn" data-i18n="BTN_LOAD_ANALYSIS"
                            class="w-full py-3 px-4 rounded-lg font-bold btn-primary">
                            載入分析圖表
                        </button>

                        <!-- 匯出按鈕 -->
                        <button id="export-employee-punch-btn" data-i18n="BTN_EXPORT_PUNCH_REPORT"
                            class="w-full py-3 px-4 rounded-lg font-bold btn-secondary hover:opacity-90 transition-opacity">
                            匯出打卡報表
                        </button>
                    </div>

                    <!-- 圖表容器 -->
                    <div id="punch-analysis-container" class="mt-6" style="display: none;">
                        <!-- 工時統計圖 -->
                        <div class="mb-6">
                            <h3 data-i18n="CHART_WORK_HOURS_TITLE"
                                class="text-lg font-semibold text-gray-800 dark:text-white mb-3">
                                每日工作時數
                            </h3>
                            <canvas id="work-hours-chart"></canvas>
                        </div>

                        <!-- 打卡時間分布圖 -->
                        <div>
                            <h3 data-i18n="CHART_PUNCH_TIME_TITLE"
                                class="text-lg font-semibold text-gray-800 dark:text-white mb-3">
                                打卡時間分布
                            </h3>
                            <canvas id="punch-time-chart"></canvas>
                        </div>
                    </div>

                    <!-- 載入中 -->
                    <div id="punch-analysis-loading" data-i18n="ANALYSIS_LOADING"
                        class="text-center text-gray-500 dark:text-gray-400 py-4" style="display: none;">
                        正在載入分析資料...
                    </div>

                    <!-- 無資料提示 -->
                    <div id="punch-analysis-empty"
                        class="text-center text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-700 p-4 rounded-lg mt-4"
                        style="display: none;">
                        <p data-i18n="ANALYSIS_NO_DATA" class="font-semibold">
                            該月份無打卡記錄
                        </p>
                    </div>
                </div>
                <div class="card p-6 mt-6">
                    <h2 data-i18n="API_TEST_TITLE" class="text-xl font-bold text-gray-800 dark:text-white mb-2">API 測試區
                    </h2>
                    <p data-i18n="API_TEST_DESCRIPTION" class="text-gray-500 dark:text-gray-400 mb-4">點擊下方按鈕以測試新的 API
                        功能。</p>
                    <div>
                        <button data-i18n="API_TEST_BTN" id="test-api-btn"
                            class="w-full py-2 px-4 rounded-lg font-bold btn-primary">測試 API</button>
                    </div>
                </div>

            </section>
        </div>
        <footer class="mt-8 text-center text-sm text-gray-500 dark:text-gray-400">
            <p>
                <span data-i18n="APP_TITLE">出勤管家</span> v4.4.1 |
                <span class="text-gray-400 dark:text-gray-500">
                    <a data-i18n="FOOTER_CREDITS" href="https://github.com/0rigind1865-bit/Attendance-System"
                        class="hover:underline hover:text-indigo-600 dark:hover:text-indigo-400">
                        由 0J 製作
                    </a>

                </span>

            </p>
        </footer>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification">
        <p id="notification-message"></p>
    </div>

    <script src="config.js"></script>
    <script src="script.js"></script>
    <!-- 👇 加班與請假功能 -->
    <script src="overtime.js"></script>
    <script src="leave.js"></script>
    <script src="salary.js"></script>
</body>


</html>
